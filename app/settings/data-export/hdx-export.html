<div>
    <div class="mode-context init" dropdown>

        <header class="mode-context-header">
            <ol class="breadcrumbs">
                <li><a href="/" ng-controller="navigation as nav">{{nav.site.name}}</a></li>
                <li><a href="/settings" translate>app.settings</a></li>
            </ol>
            <h1 class="mode-context-title" translate>app.import</h1>
        </header>

        <span class="mode-context-trigger" dropdown-toggle>
            <svg class="iconic">
                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/img/iconic-sprite.svg#chevron-bottom"></use>
            </svg>
            <span class="label hidden" translate>app.show_more_less</span>
        </span>
    </div>

    <main role="main">
        <div class="progress-bar" ng-show="isLoading()">
            <span>
            ..
            </span>
        </div>

        <div class="main-col">
            <div class="form-sheet">
                <div class="form-sheet-summary">
                <h2 class="form-sheet-title">
                Assign your HXL tags and attributes, select fields and export or upload
                </h2>
                <p>Select specific fields from a survey, assign a tag per field and then choose to assign multiple attributes. Preview your tag and attributes in tag preview.</p>

                <p>You can then choose to export your tagged fields to a CSV file or upload to a
                    <a href="#" class="link-blue">
                        <svg class="iconic">
                            <use xlink:href="/img/iconic-sprite.svg#external-link"></use>
                        </svg>
                        Humanitarian Data Exchange (HDX)
                    </a>
                account that has been set up in
                <a href="#" class="link-blue">
                    Configure HDX API
                </a>
                (found in settings menu).
                </p>

                <p>Visit the
                    <a href="#" class="link-blue">
                        <svg class="iconic">
                            <use xlink:href="/img/iconic-sprite.svg#external-link"></use>
                        </svg>
                    HXL tag assist
                    </a>
                    for more information on how to choose the best HXL tags and attributes for your data or the
                    <a href="#" class="link-blue">
                        <svg class="iconic">
                            <use xlink:href="/img/iconic-sprite.svg#external-link"></use>
                        </svg>
                        HXL 'cheat sheet'
                    </a>
                    .
                </p>

            </div>
                <fieldset ng-repeat="form in forms" ng-hide="form.targeted_survey === true">
                    <legend>
                        <bdi>{{form.name}}</bdi>
                    </legend>
                    <table>
                        <thead>
                            <tr>
                                <th></th>
                                <th>Survey field</th>
                                <th>HXL tags</th>
                                <th>HXL attributes</th>
                                <th>Tag preview</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="form-field">
                                    <input type="checkbox" ng-model="form.selected" ng-value="1" ng-change="selectAll(form)">
                                </td>
                                <td>
                                    <em>Select all<em>
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr ng-repeat="attribute in form.attributes">
                                <td class="form-field">
                                    <input
                                        type="checkbox"
                                        checklist-model="attribute.selected"
                                        checklist-value="attribute.id"
                                        ng-selected="attribute.selected"
                                    >
                                </td>
                                <td>
                                    <p><bdi>{{attribute.label}}</bdi></p>
                                </td>
                                <td>
                                    <div class="custom-select">
                                        <select
                                            ng-model="attribute.selectedTag"
                                            ng-options="tag as tag.tag_name for tag in attribute.tags track by tag.id"
                                            ng-disabled="!attribute.selected || attribute.selected.length < 1"
                                            ng-change="selectTag(attribute)"
                                        >
                                            <option value=''>Leave empty</option>
                                        </select>
                                    </div>
                                </td>
                                <td class="form-field">
                                    <div class="custom-select" ng-repeat="a in range(attribute)">
                                        <select
                                            ng-disabled="!attribute.selectedTag"
                                            ng-model="attribute.selectedAttributes[a]"
                                            ng-change="selectAttribute(attribute)"
                                        >
                                            <option value=''>Leave empty</option>
                                            <option
                                                ng-value="hxlAttribute"
                                                ng-repeat="hxlAttribute in attribute.selectedTag.hxl_attributes"
                                            >
                                                 {{hxlAttribute.attribute}}
                                            </option>

                                        </select>
                                    </div>
                                    <div class="form-field">
                                        <a ng-click="addAnother(attribute)" class="form-field link-blue">Add another hxl attribute?</a>
                                    </div>
                                </td>

                                <td>
                                    {{attribute.pretty}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </fieldset>
                <div class="form-field"  ng-hide="isLoading()">
                    <p>{{selectedFields.length}} fields selected</p>
                </div>
                <div class="form-field button-group" ng-hide="isLoading()">
                    <button class="button-alpha" ng-click="exportData()">Export to CSV</button>
                    <a ng-click="exportData()" class="button button-alpha">Upload to a hdx account</a>
                    <a ui-sref="settings.dataExport" class="button">Cancel</a>
            </div>
            </div>
        </div>
    </main>
</div>
