<div class="mode-context">

    <header class="mode-context-header">
        <ol class="breadcrumbs">
            <li><a href="/" ng-controller="navigation as nav">{{nav.site.name}}</a></li>
            <li><a href="/settings" translate>app.settings</a></li>
            <li><a href="/settings/surveys" translate>app.surveys</a></li>
        </ol>

        <h1 class="mode-context-title">Surveys</h1>
        <a ui-sref="settings.surveys.create">< <span translate="settings.send_crowdsourced"></span></a>
    </header>

    <span class="mode-context-trigger">
        <svg class="iconic">
            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/img/iconic-sprite.svg#chevron-bottom"></use>
        </svg>
        <span class="label hidden">Show more/less</span>
    </span>

    <div class="mode-context-body">
    </div>
</div>

<main role="main">
    <div class="toolbar">
    </div>

    <div class="main-col">
        <form name="targetedSurvey">
            <div ng-show="targetedSurveysEnabled" class="form-sheet">
                <div class="form-sheet-summary">
                    <h2 class="form-sheet-title">Create a new targeted survey</h2>
                    <p>Send questions via SMS to a list of those phone numbers.</p>
                </div>

                <div class="stepper">
                    <ng-form name="stepOne">
                        <div class="stepper-item" ng-class="{'active': isActiveStep(1), 'disabled': !isActiveStep(1)}">
                            <h2 class="stepper-heading" data-accordion-trigger>
                                <span class="stepper-badge">1</span>
                                Name your survey
                            </h2>
                            <div
                                class="form-field required"
                                ng-class="{
                                        'error': stepOne.name.$invalid && targetedSurvey.stepOne.name.$dirty,
                                        'success': !targetedSurvey.stepOne.name.$invalid && targetedSurvey.stepOne.name.$dirty
                                        }"
                                ng-show="isActiveStep(1)"
                            >
                                <label for="name">Survey name</label>
                                <input type="text" name="name"  ng-minlength="2" ng-maxlength="255" ng-model="name" required placeholder="Name...">
                                <div
                                    class="alert error"
                                    ng-show="targetedSurvey.stepOne.name.$dirty"
                                    ng-repeat="(error, value) in targetedSurvey.stepOne.name.$error"
                                >
                                    <svg class="iconic">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/img/iconic-sprite.svg#warning"></use>
                                    </svg>
                                    <span translate="{{'notify.form.validation.name.' + error}}"></span>
                                </div>
                            </div>
                            <div ng-hide="isActiveStep(1)">
                                <h2 class=form-label>Survey Name</h2>
                                    <p>{{name}}</p>
                            </div>
                            <div class="form-field required" ng-show="isActiveStep(1)">
                                <label for="description">Survey description</label>
                                <textarea name="description" ng-model="description" required placeholder="Describe your survey..."></textarea>
                                <div
                                    class="alert error"
                                    ng-show="targetedSurvey.stepOne.description.$dirty"
                                    ng-repeat="(error, value) in targetedSurvey.stepOne.description.$error"
                                >
                                    <svg class="iconic">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/img/iconic-sprite.svg#warning"></use>
                                    </svg>
                                    <span translate="{{'notify.form.validation.description.' + error}}"></span>
                                </div>
                            </div>
                            <div ng-hide="isActiveStep(1)">
                                <h2 class=form-label>Survey Description</h2>
                                <p>{{description}}</p>
                            </div>
                            <div ng-show="isActiveStep(1)">
                                <div class="form-field">
                                    <div class="button-group">
                                        <button class="button-alpha" ng-disabled="!isStepComplete(targetedSurvey.stepOne)" ng-click="completeStepOne()">Continue</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-form>

                    <ng-form name="stepTwo">
                        <div class="stepper-item" ng-class="{'active': isActiveStep(2), 'disabled': !isActiveStep(2)}">
                            <h2 class="stepper-heading">
                                <span class="stepper-badge">2</span>
                                    Choose your audience
                            </h2>
                            <p ng-show="isStepTwoComplete && !isActiveStep(2)">Send this message to {{finalNumbers.goodNumbers.length}} people via SMS.</p>
                            <div ng-show="isActiveStep(2)">
                                <div class="form-field">
                                    <label for="country-code" class="required">
                                        Country code 
                                    </label>
                                    <div class="custom-select">
                                        <select id="country-code" ng-options="country as country.name for country in countriesList" ng-model="selectedCountry"
                                        ><option selected value='' required>Select Country</option></select>
                                    </div>
                                </div>
                                <div class="form-field">
                                    <label>Phone numbers</label>
                                    <div class="alert error" ng-show="finalNumbers.repeatCount > 0">We removed a total of {{finalNumbers.repeatCount}} repeat number<span ng-show="finalNumbers.repeatCount > 1">s</span> from your list.</div>
                                    <div class="alert error" ng-show="finalNumbers.badNumberCount > 0">Of the original {{finalNumbers.goodNumbers.length + finalNumbers.badNumberCount + finalNumbers.repeatCount}} phone numbers you entered, we noticed problems with {{finalNumbers.badNumberCount}} of them. Please correct the phone number<span ng-show="finalNumbers.badNumberCount > 1">s</span> below and continue. Numbers must match the selected country's formatting rules.</div>
                                    <p>Please type in the phone numbers you'd like to contact. You must place a comma between each phone number.</p>
                                    <textarea name="textBoxNumbers" ng-model="textBoxNumbers" required placeholder="e.g. 1234567890, 9876543210..."></textarea>
                                    <div ng-show="finalNumbers.goodNumbers.length && finalNumbers.badNumberCount > 0">
                                        <label ng-if="finalNumbers.goodNumbers.length > 1">These {{finalNumbers.goodNumbers.length}} numbers look fine.</label>
                                        <label ng-if="finalNumbers.goodNumbers.length === 1">This {{finalNumbers.goodNumbers.length}} number looks fine.</label>
                                        <textarea readonly>{{finalNumbers.goodNumberString.slice(-1) === ',' ? finalNumbers.goodNumberString.slice(0, -1) : finalNumbers.goodNumberString}}</textarea>
                                    </div>
                                </div>
                                <div class="form-field">
                                    <div class="button-group">
                                          <button class="button-alpha" ng-disabled="!isStepComplete(targetedSurvey.stepTwo)" ng-click="completeStepTwo()">Continue</button>
                                        <button class="button" ng-click="previousStep()">Back</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-form>

                    <ng-form name="stepThree">
                        <div class="stepper-item" ng-class="{'active': isActiveStep(3), 'disabled': !isActiveStep(3)}">
                            <h2 class="stepper-heading">
                                    <span class="stepper-badge">3</span>
                                        Add your questions
                            </h2>
                                <div ng-show="isActiveStep(3)">
                                     <div class="form-field">
                                        <div class="button-group">
                                            <button class="button-alpha" ng-disabled="!isStepComplete(targetedSurvey.stepThree)" ng-click="completeStepThree()">Continue</button>
                                            <button class="button" ng-click="previousStep()">Back</button>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </ng-form>

                    <ng-form name="stepFour">
                        <div class="stepper-item" ng-class="{'active': isActiveStep(4), 'disabled': !isActiveStep(4)}">
                        <h2 class="stepper-heading">
                            <span class="stepper-badge">4</span>
                                    Publish
                        </h2>
                        <div ng-show="isActiveStep(4)">
                            <div class="button-group">
                                <button class="button-alpha"  ng-disabled="!isStepComplete(targetedSurvey.stepFour)" ng-click="publish()">Publish</button>
                                <button class="button" ng-click="previousStep()">Back</button>
                            </div>
                        </div>
                    </div>
                </ng-form>

                </div>
            </div>
        </form>
    </div>
</main>
